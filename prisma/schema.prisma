generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Existing tables from the database
model User {
  id            String        @id @default(cuid())
  email         String        @unique
  password_hash String
  name          String?
  role          String        @default("delegate") // admin | delegate | witness
  created_at    DateTime      @default(now())
  updated_at    DateTime      @updatedAt
  
  sessions      AuthSession[]
  profile       UserProfile?
  
  @@map("users")
}

model AuthSession {
  id         String   @id @default(cuid())
  user_id    String
  token      String   @unique
  expires_at DateTime
  created_at DateTime @default(now())
  
  user       User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  
  @@map("auth_sessions")
}

model UserProfile {
  id              String   @id @default(cuid())
  user_id         String   @unique
  role_extended   String   @default("volunteer") // admin | coordinator | leader | volunteer | delegate | witness
  phone           String?
  avatar_url      String?
  department      String?
  municipality    String?
  zone            String?
  points          Int      @default(0)
  badges          String[] @default([])
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
  
  user            User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  
  @@map("user_profiles")
}

model DivipoleLocation {
  id            String   @id @default(cuid())
  departamento  String
  municipio     String
  puesto        String
  direccion     String?
  comuna        String?
  mesas         Int      @default(0)
  total         Int      @default(0)
  hombres       Int      @default(0)
  mujeres       Int      @default(0)
  latitud       Float?
  longitud      Float?
  dd            String?  // C贸digo departamento
  mm            String?  // C贸digo municipio
  zz            String?  // C贸digo zona
  pp            String?  // C贸digo puesto
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt
  
  assignments   DelegatePollingAssignment[]
  votes         VoteRecord[]
  
  @@map("divipole_locations")
}

model Candidate {
  id              String   @id @default(cuid())
  name            String
  party           String?
  position        String?  // Alcalde, Concejal, Gobernador, etc.
  photo_url       String?
  color_primary   String?
  color_secondary String?
  logo_url        String?
  slogan          String?
  is_own          Boolean  @default(false) // Is this our candidate?
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
  
  votes           VoteRecord[]
  assets          CandidateAsset[]
  
  @@map("candidates")
}

model CandidateAsset {
  id           String   @id @default(cuid())
  candidate_id String
  type         String   // logo | photo | banner | document
  url          String
  name         String?
  created_at   DateTime @default(now())
  
  candidate    Candidate @relation(fields: [candidate_id], references: [id], onDelete: Cascade)
  
  @@map("candidate_assets")
}

model Party {
  id              String   @id @default(cuid())
  name            String
  abbreviation    String?
  logo_url        String?
  color_primary   String?
  color_secondary String?
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
  
  assets          PartyAsset[]
  
  @@map("parties")
}

model PartyAsset {
  id         String   @id @default(cuid())
  party_id   String
  type       String   // logo | banner | document
  url        String
  name       String?
  created_at DateTime @default(now())
  
  party      Party    @relation(fields: [party_id], references: [id], onDelete: Cascade)
  
  @@map("party_assets")
}

model DelegatePollingAssignment {
  id           String   @id @default(cuid())
  user_id      String
  location_id  String
  assigned_at  DateTime @default(now())
  status       String   @default("assigned") // assigned | confirmed | active | completed
  notes        String?
  
  location     DivipoleLocation @relation(fields: [location_id], references: [id], onDelete: Cascade)
  
  @@map("delegate_polling_assignments")
}

model VoteRecord {
  id            String   @id @default(cuid())
  location_id   String
  candidate_id  String
  mesa_number   Int
  votes         Int
  evidence_url  String?
  reported_by   String?
  verified      Boolean  @default(false)
  verified_by   String?
  verified_at   DateTime?
  notes         String?
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt
  
  location      DivipoleLocation @relation(fields: [location_id], references: [id], onDelete: Cascade)
  candidate     Candidate        @relation(fields: [candidate_id], references: [id], onDelete: Cascade)
  
  @@map("vote_records")
}

model Supporter {
  id            String   @id @default(cuid())
  name          String
  email         String?
  phone         String?
  cedula        String?
  department    String?
  municipality  String?
  address       String?
  latitud       Float?
  longitud      Float?
  support_level String   @default("potential") // potential | committed | active | leader
  notes         String?
  tags          String[] @default([])
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt
  
  activities    SupporterActivity[]
  
  @@map("supporters")
}

model SupporterActivity {
  id           String   @id @default(cuid())
  supporter_id String
  type         String   // call | visit | event | donation | volunteer
  description  String?
  date         DateTime @default(now())
  created_by   String?
  
  supporter    Supporter @relation(fields: [supporter_id], references: [id], onDelete: Cascade)
  
  @@map("supporter_activities")
}

model Event {
  id          String   @id @default(cuid())
  title       String
  description String?
  type        String?  // rally | meeting | door_to_door | training
  location    String?
  latitud     Float?
  longitud    Float?
  start_date  DateTime
  end_date    DateTime?
  status      String   @default("planned") // planned | active | completed | cancelled
  created_by  String?
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  
  attendees   EventAttendee[]
  
  @@map("events")
}

model EventAttendee {
  id         String   @id @default(cuid())
  event_id   String
  user_id    String?
  name       String?
  email      String?
  phone      String?
  status     String   @default("registered") // registered | confirmed | attended | no_show
  created_at DateTime @default(now())
  
  event      Event    @relation(fields: [event_id], references: [id], onDelete: Cascade)
  
  @@map("event_attendees")
}

model Task {
  id          String    @id @default(cuid())
  title       String
  description String?
  status      String    @default("todo") // todo | in_progress | done
  priority    String    @default("medium") // low | medium | high | urgent
  assigned_to String?
  due_date    DateTime?
  created_by  String?
  created_at  DateTime  @default(now())
  updated_at  DateTime  @updatedAt
  
  @@map("tasks")
}

model GamificationPoint {
  id         String   @id @default(cuid())
  user_id    String
  points     Int
  reason     String
  type       String   // vote_report | event_attendance | supporter_added | task_completed
  created_at DateTime @default(now())
  
  @@map("gamification_points")
}

model TerritoryZone {
  id          String   @id @default(cuid())
  name        String
  type        String   // department | municipality | zone | custom
  geojson     String?  // GeoJSON polygon data
  color       String?
  assigned_to String?
  meta        String?  // JSON metadata
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  
  @@map("territory_zones")
}

model Alert {
  id          String   @id @default(cuid())
  type        String   // coverage | anomaly | incident | system
  severity    String   @default("medium") // low | medium | high | critical
  title       String
  message     String?
  location_id String?
  resolved    Boolean  @default(false)
  resolved_by String?
  resolved_at DateTime?
  created_at  DateTime @default(now())
  
  @@map("alerts")
}
